\documentclass[a4paper,12pt]{article}
\usepackage{amsmath}
\usepackage{amssymb,amsthm,graphicx}
\usepackage{enumitem}
\usepackage{color}
\usepackage{epsfig}
\usepackage{graphics}
\usepackage{pdfpages}
\usepackage{subcaption}
\usepackage[font=small]{caption}
\usepackage[hang,flushmargin]{footmisc} 
\usepackage{float}
\usepackage{booktabs}
\usepackage[mathscr]{euscript}
\usepackage{natbib}
\usepackage{setspace}
\usepackage{mathrsfs}
\usepackage[left=2.7cm,right=2.7cm,bottom=2.7cm,top=2.7cm]{geometry}
\parindent0pt
\setlength{\parskip}{0.5em} 

\input{macros}



\begin{document}



\headingSupplement{Programs for}{``Multiscale Inference for}{Nonparametric Time Trends''}
\authors{Marina Khismatullina}{University of Bonn}{Michael Vogt}{University of Bonn} 


\version{\today}

In this document we describe the programs and functions that can be used to replicate all the empirical results reported in our paper. We first explain the model simulations and then the empirical results that were obtained with the temperature data from UK Met Office. The results are stored either as figures or as \verb|.tex| files (for tables) in the folder \verb|.\Plots|.

All programs are written in R with some functions in C. They are all quite self-explanatory and commented. The code is self-sufficient, the only thing that needs to be changed is the extensions of dynamic libraries as they are OS-specific. Dynamic libraries are defined in the beginning of each main file. At the moment everything is configured for running on Windows, that is, the \verb|.dll| extension is used. In order to make the programs Linux or MacOS compatible, this extension should be changed to \verb|.so|. For example, 
\begin{verbatim}
dyn.load("Shape/C_code/estimating_sigma.dll")
\end{verbatim} should be replaced by
\begin{verbatim}
dyn.load("Shape/C_code/estimating_sigma.so").
\end{verbatim}

All the dynamic libraries are already provided, additional  compilation is not neccessary.

\section{Model Simulations}
\subsection{Testing for the presence of the time trend}
The folder \verb|.\Shape| contains all the necessary functions, data and simulated distributions that were used for calculatig size and power of our method for testing for the presence of time trends in Section 7. In order to obtain Tables 1 and 2, one needs to run \verb|.\main_shape_simulation.R|. As was already mentioned, the only possible adjustment that needs to be done is the change of extension of dynamic libraries in the beginning of \verb|.\main_shape_simulation.R|. 


The simulated distributions of Gaussian statistic $\Phi'_{T}$ for various lengths of time trends $T$ can be found in the directory \verb|.\Shape\distribution|. In order to be able to recalculate these distributions, the stored files need to be deleted or removed; the computation is then done automatically.


Size and power of the test are calculated by generating $1000$ samples. This number can be set as \verb|N_rep| in \verb|.\main_shape_simulation.R|. We have run our simulations for $10000$ samples as well, and the running time is quite small.


The dynamic libraries and R-wrappers of respective C functions are provided in the folder \verb|.\Shape\C_code|.

All the auxiliary functions can be found in \verb|.\Shape\functions.R|.


\subsection{Testing for equality of the trends}
The folder \verb|.\Equality| contains all the necessary functions, data and simulated distributions that were used for testing the equality of time trends in Section 7. Specifically, in order to obtain Tables 3, 4 and 5, one needs to run \verb|.\main_equality_simulation.R|. Do not forget to change the extensions of dynamic libraries in the very beginning of \verb|.\main_equality_simulation.R| (if needed).

The directory \verb|.\Equality\distribution| comprises the simulated distributions of gaussian statistic $\Phi_{n, T}$ for $n= 15$ time series (the number that was used for the simulation study) and different lengths of time trends $T$. If you want to recalculate the distribution, the stored files need to be deleted or removed. The recomputation is then done automatically. However, note that with increasing values of time series length $T$ the running time increases significantly. For example, for $T = 1000$ and $n = 15$ calculation of $\Phi_{n, T}$ will probably take several hours.


The dynamic libraries and R-wrappers of respective C functions are provided in the folder \verb|.\Equality\C_code|.


All the auxiliary functions can be found in \verb|.\Equality\functions.R|.


Size and power of the test are calculated generating $1000$ samples. This number can be set as \verb|N_rep| in \verb|.\main_equality_simulation.R|, though rising this parameter is not advisable due to computational tractability. 

\section{Application}
\subsection{Testing for the presence of the time trend}

The file \verb|.\Shape\data\cetml1659on.dat| contains the monthly and yearly mean central England temperature from the year 1659 up to year 2017. It was downloaded from 
\begin{verbatim}
https://www.metoffice.gov.uk/hadobs/hadcet/data/download.html.
\end{verbatim}
Full description of the data can be accessed on the official website of The UK Met Office \verb|https://www.metoffice.gov.uk|. 


As for the simulation study, the dynamic libraries and R-wrappers of respective C functions are provided in the directory \verb|.\Shape\C_code|. 


The distribution of the Gaussian statistic $\Phi'_T$, that was used for calculating quantiles for the application, is stored in the file
\begin{verbatim}
.\Shape\distribution\distr_T_359_testing_constant_type_ll.RData.
\end{verbatim} 
As before, the recalculating of the Gaussian statistic distribution can be done by removing or deleting this file before running \verb|N_rep| in \verb|.\main_equality_simulation.R|.  

All the auxiliary functions can be found in \verb|.\Shape\functions.R|.


\subsection{Testing for equality of the trends}
The directory \verb|.\Equality\data| contains the historic station data in \verb|.txt| format downloaded from 
\begin{verbatim}
https://www.metoffice.gov.uk/public/weather/climate-historic/#?tab=climateHistoric
\end{verbatim}
and the description file \verb|.\Equality\Description_file.xlsx|. The data consists of:
\begin{itemize}
\item Mean daily maximum temperature ($tmax$)
\item Mean daily minimum temperature ($tmin$)
\item Days of air frost ($af$)
\item Total rainfall ($rain$)
\item Total sunshine duration ($sun$)
\end{itemize}
The monthly mean temperature that was used in the paper is calculated from the average of the mean daily maximum and mean daily minimum temperature, i.e.\ $(tmax+tmin)/2$. Full description of the data can be accessed on the official website of The UK Met Office \verb|https://www.metoffice.gov.uk|. 

The distribution of the Gaussian statistic $\Phi'_{n, T}$, that was used for calculating quantiles for this application, is stored in the file
\begin{verbatim}
.\Equality\distribution\
distr_for_application_T_386_and_N_ts_25_and_method_ll.RData.
\end{verbatim} You can recalculate the distribution in order to check our results. In order to do so, delete or move the file mentioned above and the dstribution of the new Gaussian statistic will be computed automatically.


As for the simulation study, the dynamic libraries and R-wrappers of respective C functions are provided in the folder \verb|.\Equality\C_code|. 


All the auxiliary functions can be found in \verb|.\Equality\functions.R|.

%Of course you can change anything else, but be aware of computing time when doing the simulations.

\end{document}
